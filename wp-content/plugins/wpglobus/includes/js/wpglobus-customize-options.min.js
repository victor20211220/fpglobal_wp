jQuery(document).ready(function(a){"use strict";var c={listID:"#wpglobus-sortable",customizeSave:!1,customizeSaveData:"",init:function(){a("#wpglobus-sortable").sortable({update:c.sortUpdate}),c.setJSCodeSection(),c.addListeners(),c.ajaxListener()},setJSCodeSection:function(){var o=WPGlobusCustomizeOptions.settings.wpglobus_js_editor_section;void 0!==o&&void 0!==o.wpglobus_customize_js_editor&&(a("#customize-control-wpglobus_customize_js_editor .customize-control-title").css({width:"50%"}).after('<span class="wpglobus-customize-js-editor-expand" style="float:right;"><a href="#">'+WPGlobusCustomizeOptions.i18n.expandShrink+"</a></span>"),a(document).on("click",".wpglobus-customize-js-editor-expand",function(o){var e=a(this),t=a("#customize-controls");e.toggleClass("expanded"),e.hasClass("expanded")?t.css({width:"500px"}):t.css({width:""})}),a("#sub-accordion-section-wpglobus_js_editor_section .customize-section-back").on("click",function(o){a("#customize-controls").css({width:""}),a(".wpglobus-customize-js-editor-expand").removeClass("expanded")}))},addListeners:function(){a("body").on("change",".wpglobus-listen-change",function(o){c.setState(!1)}),a("body").on("change","#wpglobus-sortable input.wpglobus-language-item",function(o){var e=a(this);e.prop("checked")||c.removeLanguage(e)}),a("#customize-control-wpglobus_add_languages_select_box select").on("change",function(o){c.addLanguage(o,this)}),a("#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title").off("click keydown"),a("body").on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title",function(o){window.open(WPGlobusCustomizeOptions.addonsPage,"_blank")}),a(document).on("click","#"+WPGlobusCustomizeOptions.userControlSaveButton,function(){c.userControlAjax(this)}),a(document).on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_js_editor_section+" .accordion-section-title",function(o){a("#customize-control-wpglobus_customize_js_editor .CodeMirror").css({height:"40em"})})},removeLanguage:function(o){var e=o.data("language"),t=a("#customize-control-wpglobus_add_languages_select_box select option").eq(0);a('<option value="'+e+'">'+WPGlobusCustomizeOptions.config.language_name[e]+" ("+WPGlobusCustomizeOptions.config.en_language_name[e]+") </option>").insertAfter(t),o.parent("li").remove()},addLanguage:function(o,e){var t=a(e).attr("value"),s=a("#wpglobus-item-skeleton").html(),n="",i=a(c.listID+" li").attr("class");"select"!=t&&(n=(n=(n=(n=(n=(n=(n=(n=(n=s.replace("{{flag}}",'src="'+WPGlobusCustomizeOptions.config.flags_url+WPGlobusCustomizeOptions.config.flag[t]+'"')).replace("{{name}}",t)).replace("{{id}}",t)).replace('checked="{{checked}}"','checked="checked"')).replace('disabled="{{disabled}}"',"")).replace("{{item}}",WPGlobusCustomizeOptions.config.en_language_name[t]+" ("+t+") ")).replace("{{order}}","#")).replace("{{language}}",t)).replace("{{edit-link}}",WPGlobusCustomizeOptions.editLink.replace("{{language}}",t)),a('<li class="'+i+'">'+n+"</li>").appendTo(c.listID),c.setOrder(),e=a(e).find("option"),a.each(e,function(o,e){a(e).attr("value")==t&&a(e).remove()}))},sortUpdate:function(o,e){c.setState(!1),c.setOrder()},setOrder:function(){a("#wpglobus-sortable input.wpglobus-language-item").each(function(o,e){e=a(e);0==o?e.prop("disabled","disabled").prop("checked","checked"):e.removeProp("disabled"),e.data("order",o)})},setState:function(o){wp.customize.state("saved").set(o)},getCustomizeSaveData:function(){return c.customizeSaveData},enabledUserControl:function(o){return void 0!==WPGlobusCustomize.controlInstances[o]&&WPGlobusCustomize.controlInstances[o].userControl.enabled},userControlAjax:function(o){a(o).prop("disabled",!0);var t={action:"cb-controls-save",controls:{}};a(".wpglobus-customize-cb-control").each(function(o,e){e=a(e);e.prop("checked")||(e=(e=(e=e.data("control")).replace("[","{{")).replace("]","}}"),t.controls[e]="disable")}),a.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:t},dataType:"json"}).done(function(o){}).fail(function(o,e){}).always(function(){location.reload(!0)})},ajax:function(o,e){var i;"wpglobus_customize_save"==o&&(i={action:"wpglobus_customize_save",options:{}},a.each(WPGlobusCustomizeOptions.settings,function(o,e){a.each(e,function(o,t){return"wpglobus_customize_enabled_languages"==o?(i.options[t.option]={},a("#wpglobus-sortable input.wpglobus-language-item").each(function(o,e){i.options[t.option][a(this).data("language")]="1"}),!0):void(-1!=c.customizeSaveData.indexOf("wpglobus_customize_post_type_")&&-1!=o.indexOf("wpglobus_customize_post_type_")?(void 0===i.options[t.option]&&(i.options[t.option]={}),i.options[t.option][o.replace("wpglobus_customize_post_type_","")]=a("#customize-control-"+o+" input").prop("checked")?1:0):-1!=c.customizeSaveData.indexOf(o)&&(e=a("#customize-control-"+o+" "+t.type),s="","textarea"==t.type?s=e.val():"wpglobus_checkbox"==t.type?(e=a("#customize-control-"+o+" input"),s="wpglobus_customize_selector_wp_list_pages"==o?e.prop("checked")?1:0:e.prop("checked")?1:""):"checkbox"==t.type?s=e.prop("checked")?1:"":"select"==t.type?s=e.val():"code_editor"!=t.type||void 0!==(n=wp.customize.control.instance(o))&&(s=n.setting()),i.options[t.option]=s,"code_editor"==t.type&&void 0===n&&delete i.options[t.option]));var e,s,n})})),a.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:i},dataType:"json"}).done(function(o){}).fail(function(o,e){}).always(function(o,e){})},getChangesetData:function(o){if(void 0!==o){var e=/customize_changeset_data=([^&]+)/.exec(o);if(void 0===e[1])return;var t,s=decodeURIComponent(e[1]),n=JSON.parse(s);a.each(n,function(o,e){void 0!==WPGlobusCustomize.controlInstances[o]&&(t="",t=(WPGlobusCustomize.controlInstances[o].type,WPGlobusCustomize.controlInstances[o].setting),n[o].value=t)});s=JSON.stringify(n);s=(s=encodeURIComponent(s)).replace(/%20/g,"+"),o=o.replace(e[1],s)}return o},ajaxListener:function(){a(document).on("ajaxSend",function(o,e,t){void 0!==t.data&&-1!=t.data.indexOf("wp_customize=on")&&-1!=t.data.indexOf("action=customize_save")&&(-1!=t.data.indexOf("customized=")?(c.customizeSave=!0,c.customizeSaveData=t.data):-1!=t.data.indexOf("customize_changeset_data=")&&(t.data=c.getChangesetData(t.data)))}),a(document).on("ajaxComplete",function(o,e,t){void 0!==e.responseText&&c.customizeSave&&(c.customizeSave=!1,c.ajax("wpglobus_customize_save"))}),a(document).on("ajaxStop",function(){c.customizeSave&&(c.customizeSave=!1,c.ajax("wpglobus_customize_save"))})}};WPGlobusCustomizeOptions=a.extend({},WPGlobusCustomizeOptions,c),WPGlobusCustomizeOptions.init()});