!function(g){"use strict";var s;"undefined"!=typeof WPGlobusWidgets&&(s={saveArbitraryTextOrHTML:!1,editor:{},languageBoxActive:!1,languageBoxTimeout:null,imageWidgets:{},parseBool:function(e){return!/^(false|0)$/i.test(e)&&!!e},init:function(){s.parseBool(WPGlobusWidgets.useWidgetsBlockEditor)||(s.addElements(),s.attachListeners(),s.arbitraryTextOrHTML())},wysiwygClean:function(){g(".wpglobus-dialog-field").each(function(e,t){var i=g(t).data("source-id");1==g("#"+i+"-tmce").length&&(i=g(t).next(".wpglobus_dialog_start"),g(t).remove(),g(i).remove())})},setupWidgetControl:function(i,e,o){var a,n,d,l,t,r=!1;g.each(s.editor,function(e,t){if(t.widgetName==i)return!(r=!0)}),r||(""==(a=e.$el[0].id)&&(t=e.$el[0].offsetParent,void 0===(a=g(t).attr("id"))&&g(".widget").each(function(e,t){t=g(t).attr("id");if(-1!=t.indexOf(i))return a=t,!1})),n="#"+a+" #widget-"+i+"-text",t="#"+a+" #widget-"+i+"-title",s.editor[o.id]={},s.editor[o.id].widgetName=i,s.editor[o.id].controls=e,s.editor[o.id].sourceTitleSelector=t,s.editor[o.id].titleSelector=null,s.editor[o.id].sourceSelector=n,s.editor[o.id].content=g(n).val(),s.editor[o.id].saveSelector="#"+a+" #widget-"+i+"-savewidget",s.editor[o.id].languageSelector="#"+a+" .wpglobus-current-language",s.editor[o.id].inWidgetTitleSelector="#"+a+" .in-widget-title",t=WPGlobusCore.TextFilter(s.editor[o.id].content,WPGlobusCoreData.language,"RETURN_EMPTY"),g("#"+o.id).val(t),l=d="",g.each(WPGlobusCoreData.enabled_languages,function(e,t){d=(d=(d=(d=(d=(d=(d='<a href="#" onclick="return false;" class="item" data-widget-id="{{widgetID}}" data-source="{{source}}" data-editor-id="{{editorID}}" data-language="{{language}}" data-widget-name="{{widgetName}}" style="text-align:center;"><span>{{item}}</span></a>').replace("{{language}}",t)).replace("{{item}}",WPGlobusCoreData.en_language_name[t])).replace("{{widgetName}}",i)).replace("{{widgetID}}",a)).replace("{{editorID}}",o.id)).replace("{{source}}",n),l+=d}),t='<button style="z-index:200000;" type="button" id="'+o.id+'-wpglobus-button" data-widget-id="'+a+'"class="wp-switch-editor switch-wpglobus-language wpglobus-icon-globe"><span class="wpglobus-current-language" data-language="'+WPGlobusCoreData.language+'" style="">'+WPGlobusCoreData.language+'</span></button><div class="wpglobus-language-box" style="position:absolute;top:0;left:0;display:none;z-index:200100;border:1px solid #9e9e9e;border-radius:3px;background-color:#fff;padding: 2px 5px;"><div style="display:flex;flex-direction:column;">'+l+"</div></div>",g("#"+a+" .wp-editor-tabs").append(t),WPGlobusDialogApp.addElement({id:e.fields.title[0].id,style:"width:93%;"})&&(s.editor[o.id].titleSelector="#"+e.fields.title[0].id),s.arbitraryWidgetTitle(o.id),g(n).hasClass("hidden")&&(e=g(n).parent(),g(e).find("div.wpglobus-widgets.wpglobus_dialog_start.wpglobus_dialog_icon").css({display:"none"})))},arbitraryWidgetTitle:function(e){var t=WPGlobusCore.TextFilter(g("#"+s.editor[e].controls.fields.title[0].id).val(),WPGlobusCoreData.language);g(s.editor[e].inWidgetTitleSelector).text(": "+t)},setBoxTimeout:function(){s.languageBoxTimeout=setTimeout(function(){s.languageBoxActive=!1,g(".wpglobus-language-box").css({display:"none"})},1e3)},arbitraryTextOrHTML:function(){function i(e){var t,i="",i="keyup"==e.type&&"tinymce"==e.target.id?g(e.target).data("id"):e.target.id;s.editor[i]&&(t=g(s.editor[i].languageSelector).data("language"),e="",e=tinymce.get(i).isHidden()?g("#"+i).val():tinymce.get(i).getContent({format:"raw"}),s.editor[i].content=WPGlobusCore.getString(s.editor[i].content,e,t),g(s.editor[i].sourceSelector).val(s.editor[i].content))}g(document).on("click",".switch-wpglobus-language",function(e){var t,i;s.languageBoxActive||(s.languageBoxActive=!0,t=(i=g(this)).data("widget-id"),(i=i.position()).top+=34,i.left+=10,g("#"+t+" .wpglobus-language-box").css({display:"block",top:i.top+"px",left:i.left+"px"}),s.setBoxTimeout())}),g(document).on("mouseenter",".wpglobus-language-box",function(e){clearTimeout(s.languageBoxTimeout)}).on("mouseleave",".wpglobus-language-box",function(e){g(".wpglobus-language-box").css({display:"none"}),s.languageBoxActive=!1}),g(document).on("click",".wpglobus-language-box .item",function(e){var t=g(this),i=t.data("language"),o=t.data("widget-id"),t=t.data("editor-id");g("#"+o+" .wpglobus-current-language").text(i).data("language",i);i=WPGlobusCore.TextFilter(s.editor[t].content,i,"RETURN_EMPTY");tinymce.get(t).setContent(i,{format:"raw"}),g("textarea#"+t).val(i)}),g(document).on("tinymce-editor-setup",function(e,i){g.each(wp.textWidgets.widgetControls,function(e,t){s.setupWidgetControl(e,t,i)})}),g(document).on("tinymce-editor-init",function(e,t){g(document).on("mouseenter",s.editor[t.id].saveSelector,function(e){g(s.editor[t.id].sourceTitleSelector).val(g(s.editor[t.id].titleSelector).val()),g(s.editor[t.id].sourceSelector).val(s.editor[t.id].content)}),g(document).on("click",s.editor[t.id].saveSelector,function(e){s.saveArbitraryTextOrHTML=t.id}),t.on("nodechange keyup",_.debounce(i,100)),g("#"+t.id).on("keyup",_.debounce(i,100))})},addElements:function(e,t){var i,o=[];o[0]='input[type="text"]',o[1]="textarea",void 0===e||"class"==e?(i=".widget-liquid-right .widget .widget-content",g.each(o,function(e,t){s.makeClone(i,t)})):"id"==e&&(i="#"+t+" .widget-content",g.each(o,function(e,t){s.makeClone(i,t)}))},makeClone:function(e,d){g(e+" "+d).each(function(e,t){var i,o=g(t),a=!1,n=o.attr("id");return void 0===n||-1!=n.indexOf("-number")||""==n||(_.each(WPGlobusWidgets.disabledMask,function(e){if(-1!=n.indexOf(e))return!(a=!0)}),!!a||void(-1!=n.indexOf("-title")&&(i=g("#"+n).clone(),g(o).addClass("wpglobus-dialog-field-source hidden"),t=o.attr("name"),g(i).attr("id","wpglobus-"+n),g(i).attr("name","wpglobus-"+t),g(i).attr("data-source-id",n),g(i).attr("class","wpglobus-dialog-field"),g(i).attr("style","width:90%;"),t=WPGlobusCore.TextFilter(g(o).val(),WPGlobusCoreData.language),g(i).val(t),g('<div style="width:20px;" data-type="control" data-source-type="" data-source-id="'+n+'" class="wpglobus-widgets wpglobus_dialog_start wpglobus_dialog_icon"></div>').insertAfter(o),g(i).insertAfter(o),'input[type="text"]'==d&&""!=t&&(o=o.parents(".widget").attr("id"),g("#"+o+" .in-widget-title").text(": "+t)))))})},attachListeners:function(){g(document).ajaxComplete(function(e,t,i){if(-1!=i.data.indexOf("action=save-widget")&&-1==i.data.indexOf("delete_widget=1")){if(s.saveArbitraryTextOrHTML){var o=WPGlobusCore.TextFilter(s.editor[s.saveArbitraryTextOrHTML].content,g(s.editor[s.saveArbitraryTextOrHTML].languageSelector).data("language"),"RETURN_EMPTY");return tinymce.get(s.saveArbitraryTextOrHTML).isHidden()?(g("#"+s.saveArbitraryTextOrHTML).val(o),g("#"+s.saveArbitraryTextOrHTML+"-tmce").click()):tinymce.get(s.saveArbitraryTextOrHTML).setContent(o,{format:"raw"}),s.arbitraryWidgetTitle(s.saveArbitraryTextOrHTML),void(s.saveArbitraryTextOrHTML=!1)}var a=(a=i.data.split("widget-id="))[1].split("&");g(".widget-liquid-right .widget").each(function(e,t){t=g(t).attr("id");-1!==t.indexOf(a[0])&&(s.addElements("id",t),s.wysiwygClean())})}}),g("body").on("change",".wpglobus-dialog-field",function(){var i,o,a=g(this),e="#"+a.data("source-id"),n="";i=g(e).val(),/(\{:|\[:|<!--:)[a-z]{2}/.test(i)?(g.each(WPGlobusCoreData.enabled_languages,function(e,t){""!=(o=t==WPGlobusCoreData.language?a.val():WPGlobusCore.TextFilter(i,t,"RETURN_EMPTY"))&&(n+=WPGlobusCore.addLocaleMarks(o,t))}),g(e).val(n)):g(e).val(a.val())}),g(document).on("click",".widget-title, .widget-title-action",function(e){e.preventDefault(),s.wysiwygClean(),s.setImageWidget(this)})},getImageWidgets:function(e){return s.imageWidgets},setImageWidget:function(e){e=g(e).parents(".widget").attr("id");void 0!==e&&-1!=e.indexOf("media_image")&&void 0===s.imageWidgets[e]&&(g('<hr /><div class="">'+WPGlobusWidgets.l10n.imageWidget.suggest+"</div>").appendTo("#"+e+" .widget-inside"),s.imageWidgets[e]=!0)},__getEditorContent:function(){if(0!=Object.keys(s.editor).length)for(var i in console.log("WPGlobusWidgets editors length is: ",Object.keys(s.editor).length),s.editor)console.log("editor        : ",i," -> widgetName: ",s.editor[i].widgetName),console.log("source content: ",s.editor[i].content),g.each(WPGlobusCoreData.enabled_languages,function(e,t){console.log("Language: ",t);t=WPGlobusCore.TextFilter(s.editor[i].content,t,"RETURN_EMPTY");""==t?console.log("empty"):console.log("Content: ",t)}),console.log("--------------------");else console.log("WPGlobusWidgets editors length is: 0")},__getEditorLanguage:function(){if(0!=Object.keys(s.editor).length)for(var e in console.log("WPGlobusWidgets editors length is: ",Object.keys(s.editor).length),s.editor)console.log("editor           : ",e," -> widgetName: ",s.editor[e].widgetName),console.log("current language : ",g(s.editor[e].languageSelector).data("language")),console.log("--------------------");else console.log("WPGlobusWidgets editors length is: 0")}},WPGlobusWidgets=g.extend({},WPGlobusWidgets,s))}(jQuery);