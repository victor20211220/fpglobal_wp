jQuery(document).ready(function(c){"use strict";var a={languages:{},index:0,length:0,controlInstances:{},controlWidgets:{},instancesKeep:!1,widgetKeep:!1,action:!1,customizeSave:!1,selectorHtml:"",settingsSectionExpand:function(){c(document).triggerHandler("wpglobus_fields_settings_section_expand",[this,a])},init:function(t){a.selectorHtml=WPGlobusCustomize.selector_html,a.setTitle(),"false"!=WPGlobusCustomizeOptions.themeEnabled&&(c.each(WPGlobusCoreData.enabled_languages,function(t,e){a.languages[t]=e,a.length=t}),a.addLanguageSelector(),a.setControlInstances(),a.setFieldsSection(),a.attachListeners(),a.setTinymce())},updateTinymce:function(t){"tinymce"==WPGlobusCustomize.controlInstances[this.id].type&&(WPGlobusCustomize.controlInstances[this.id].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[this.id].setting,t.target.textContent,WPGlobusCoreData.language))},setTinymce:function(t){c(document).on("tinymce-editor-init",function(t,e){"object"==typeof a.controlInstances[e.id]&&(a.controlInstances[e.id].type="tinymce",c(e.iframeElement).addClass("wpglobus-customize-control").css({width:"99%"}),e.on("input",_.debounce(a.updateTinymce,300)))})},getSize:function(t){return void 0===t?_.size(a.controlInstances):"widget"==t?_.size(a.controlWidgets):null},setFieldsSection:function(){var o={},n=c(".wpglobus-fields_settings_control_box").data("section-template"),s="",l="",i="";c.each(WPGlobusCustomize.controlInstances,function(t,e){void 0===o[e.section]&&(o[e.section]={}),o[e.section][t]=e}),c.each(o,function(t,e){return l="<ul>",c.each(e,function(t,e){i=e.userControl.enabled?" checked ":"",l+='<li id="'+e.fieldSettings.itemID+'">',l+='<input id="'+e.fieldSettings.cbID+'" data-control="'+t+'" class="wpglobus-customize-cb-control" type="checkbox"'+i+' /> <span class="wpglobus-cb-control-title">'+e.title+"</span>",l+="</li>"}),l+="</ul>",void 0===wp.customize.section(t)||(s=(s=(s=(s=n.replace("{{section_title}}",wp.customize.section(t).params.title)).replace(/{{section}}/g,t)).replace("{{section_id}}",'"'+t+'"')).replace("{{items}}",l),void c(s).insertBefore(c("."+WPGlobusCustomizeOptions.userControlButtonsWrapper)))}),c("#accordion-section-wpglobus_fields_settings_section").css({"margin-top":"15px"}),c(WPGlobusCustomizeOptions.helpButton).insertAfter(c("#accordion-section-wpglobus_fields_settings_section .customize-action")),c("#accordion-section-wpglobus_fields_settings_section .customize-section-description").addClass("hidden"),c(document).on("click","."+WPGlobusCustomizeOptions.userControlIconClass,function(t){var o=c(this).data("section");c(WPGlobusCustomizeOptions.userControlBoxSelector).each(function(t,e){o==c(e).data("section")?c(this).css({display:"block"}):c(this).css({display:"none"})}),wp.customize.control("wpglobus_fields_settings_section").expand({completeCallback:a.settingsSectionExpand})}),c(".wpglobus-customize-icon-help.customize-help-toggle").on("click",function(t){c("#accordion-section-wpglobus_fields_settings_section .customize-section-description").toggleClass("hidden")})},setUserControls:function(t,e){var o=e.controlSelector+" "+e.selector,n='<img class="'+WPGlobusCustomizeOptions.userControlIconClass+'" data-section="'+e.section+'" style="position:absolute;right:0px;cursor:pointer;" src="'+WPGlobusCustomizeOptions.userControlIcon+'" />';c(n).insertBefore(o),e.userControl.enabled||(1<c(o).length?c(o).each(function(t,e){c(e).removeClass(WPGlobusCustomize.controlClass)}):c(o).removeClass(WPGlobusCustomize.controlClass).val(e.setting))},ctrlMenuItemsCallback:function(t,e){},ctrlWidgetCallback:function(s,l){var t;a.action=!1,void 0===a.controlWidgets[s].element&&(void 0===l&&(l=wp.customize.control.instance(s)),a.controlWidgets[s].element={},a.controlWidgets[s].control=l,a.controlWidgets[s].inWidgetTitle=l.container.find(".in-widget-title"),a.controlWidgets[s].parent=l.selector,0!=(t=l.container.find("input[type=submit]")).length&&(t.css({display:"block"}),t.attr("data-widget",s),a.controlWidgets[s].submit=t,a.attachWidgetListeners(a.controlWidgets[s])),l.liveUpdateMode=!1,void 0===l.setting().title?a.controlWidgets[s].inWidgetTitle.text(""):a.controlWidgets[s].inWidgetTitle.text(": "+WPGlobusCore.TextFilter(l.setting().title,WPGlobusCustomize.languageAdmin)),c.each(WPGlobusCustomize.elementSelector,function(t,o){var n=l.container.find(o);0!=n.length&&c.each(n,function(t,e){if(void 0===e.id||""==e.id)return!0;t=c(n[t]);void 0===a.controlWidgets[s].element[e.id]&&(a.controlWidgets[s].element[e.id]={}),t.addClass("wpglobus-customize-widget-control"),t.attr("data-widget",s),a.controlWidgets[s].element[e.id].element=t,a.controlWidgets[s].element[e.id].setting=l.setting(),a.controlWidgets[s].element[e.id].selector=o,a.controlWidgets[s].element[e.id].value=e.defaultValue,t.val(WPGlobusCore.TextFilter(e.defaultValue,WPGlobusCoreData.language,"RETURN_EMPTY"))})}),c(document).triggerHandler("wpglobus_customize_control_added_widget",[s]))},ctrlCallback:function(o,n,t){var s=!1;if(c.each(WPGlobusCustomize.disabledSections,function(t,e){if(o.section()==e)return!(s=!0)}),!s&&(c.each(WPGlobusCustomize.disabledSettingMask,function(t,e){if(0<=n.indexOf(e))return!(s=!0)}),!s)){var l,i=wp.customize.control.instance(n);if(0<=n.indexOf("widget"))return void 0===a.controlWidgets[n]&&(a.controlWidgets[n]={},a.action&&a.ctrlWidgetCallback(n,i)),a.controlWidgets[n].parent=i.selector,1!=c(i.selector).length?a.controlWidgets[n].observer=null:(a.controlWidgets[n].observer=new MutationObserver(function(t){t.forEach(function(t){"class"==t.attributeName&&-1!=t.target.className.indexOf("expanding")&&a.ctrlWidgetCallback(n)})}),a.controlWidgets[n].observer.observe(document.querySelector(a.controlWidgets[n].parent),{attributes:!0,childList:!0,characterData:!0})),!1;void 0===a.controlInstances[n]&&(l=!0,c.each(WPGlobusCustomize.elementSelector,function(t,e){var o=i.container.find(e);if(0!=o.length){if("function"!=typeof i.setting)return!0;o.attr("id"),a.controlInstances[n]={},a.controlInstances[n].element=o,a.controlInstances[n].elementID=o.attr("id")?"#"+o.attr("id"):void 0,a.controlInstances[n].setting=i.setting(),a.controlInstances[n].settingType=typeof i.setting(),a.controlInstances[n].selector=e,a.controlInstances[n].controlSelector=i.selector,a.controlInstances[n].type="",a.controlInstances[n].section=i.section(),a.controlInstances[n].title=null,a.controlInstances[n].userControl=null,a.controlInstances[n].fieldSettings={},a.controlInstances[n].fieldSettings.itemID="item-wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(n),a.controlInstances[n].fieldSettings.cbID="wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(n),c.each(WPGlobusCustomize.setLinkBy,function(t,e){0<=n.indexOf(e)&&(a.controlInstances[n].type="link",""==a.controlInstances[n].setting&&(a.controlInstances[n].setting=o[0].defaultValue),!WPGlobusCustomize.changeset_uuid||-1!==(e=wp.customize.control(n).setting()).indexOf("|||")&&(e=a.getTranslations(e),wp.customize.control(n).setting(e[WPGlobusCoreData.default_language]),c(WPGlobusCustomize.controlInstances[n].controlSelector+" "+WPGlobusCustomize.controlInstances[n].selector).val(e[WPGlobusCoreData.default_language])),o.addClass("wpglobus-control-link"))}),""===a.controlInstances[n].type&&(a.controlInstances[n].type="textarea"==e?"textarea":"text"),"string"==a.controlInstances[n].settingType&&""!=a.controlInstances[n].setting&&o.val(WPGlobusCore.TextFilter(a.controlInstances[n].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),o.addClass("wpglobus-customize-control"),o.attr("data-wpglobus-customize-control",a.controlInstances[n].controlSelector.replace("#customize-control-","")),o.attr("data-wpglobus-customize-control-setting-type",a.controlInstances[n].settingType),"link"==a.controlInstances[n].type&&(a.controlInstances[n].setting=a.convertString(o[0].defaultValue)),a.controlInstances[n].title=i.params.label,null!==WPGlobusCustomizeOptions.userControl&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName]&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][n]&&"disable"==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][n]&&(l=!1),a.controlInstances[n].userControl={},a.controlInstances[n].userControl.enabled=l,a.setUserControls(n,a.controlInstances[n])}}))}},getControlInstances:function(o,n){"string"!=typeof o?console.log(a.controlInstances):c.each(a.controlInstances,function(t,e){-1!==t.indexOf(o)&&("string"==typeof n?console.log(t+" ->",n+":: ",e[n]):console.log(t,e))})},setControlInstances:function(){wp.customize.control.each(a.ctrlCallback)},setTitle:function(){c(WPGlobusCoreData.customize.info.element).html(WPGlobusCoreData.customize.info.html)},convertString:function(t){if(void 0===t)return t;var o=[],e=WPGlobusCore.getTranslations(t),n=0,s=!0;return t==e[WPGlobusCoreData.default_language]?t:(c.each(e,function(t,e){""==e?o[n]="null":(s=!1,o[n]=e),n++}),s?"":o.join("|||"))},getTranslations:function(t){if(void 0===t)return t;var o={},n=t.split("|||");return c.each(WPGlobusCoreData.enabled_languages,function(t,e){o[e]=void 0===n[t]||"null"===n[t]?"":n[t]}),o},getString:function(t,o,n){if(void 0===t)return t;void 0===o&&(o=""),void 0===n&&(n=WPGlobusCoreData.language);var t=a.getTranslations(t),s=[],l=0,i=!0;return c.each(t,function(t,e){t==n?(o=o.trim(),s[l]=""==o?"null":o):s[l]=""==e?"null":e,t!=WPGlobusCoreData.default_language&&"null"!=s[l]&&(i=!1),l++}),s=i?s[0]:s.join("|||")},addLanguageSelector:function(){"dropdown"!=WPGlobusCustomize.selectorType?(c(WPGlobusCustomize.selectorButton).insertAfter(".customize-controls-preview-toggle"),c(".wpglobus-customize-selector").html(a.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),c(document).on("click",".wpglobus-customize-selector",function(t){a.index>a.length-1?a.index=0:a.index++,WPGlobusCoreData.language=a.languages[a.index],c(this).html(a.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),c(document).triggerHandler("wpglobus_customize_control_language",[WPGlobusCoreData.language]),a.setControlsValue()})):a.addLanguageSelectorDropdown()},addLanguageSelectorDropdown:function(){c(WPGlobusCustomize.selectorButton).insertAfter(".customize-controls-preview-toggle"),c(".wpglobus-customize-selector").html(a.selectorHtml.replace("{{language}}",WPGlobusCoreData.language));var t=c(".wpglobus-customize-selector").offset(),e=t.top+46,t=t.left+"px;",o=0,n='<ul class="wpglobus-customize-selector-dropdown" style="display:none;position:fixed;width:46px;border-left:1px solid #ddd;border-right:1px solid #ddd;background-color:#eee;margin:-1px 0 0;padding:0;top:'+(e+="px;")+"left:"+t+'">';c.each(WPGlobusCoreData.enabled_languages,function(t,e){n+='<li class="item" style="text-align:center;cursor:pointer;border-bottom:1px solid #ddd;margin:0;" data-language="'+e+'">',n+='<span class="value value-'+e+'" style="font-size:15px;">'+e+"</span>",n+="</li>"}),n+='<li class="item wpglobus-customize-item-settings" style="text-align:center;cursor:pointer;border-bottom:1px solid #ddd;margin:0;"><span style="padding-top:14px;" class="dashicons dashicons-admin-tools"></span></li>',n+="</ul>",c(".wpglobus-customize-selector").after(n),c(document).on("mouseenter",".wpglobus-customize-selector",function(t){c(".wpglobus-customize-selector-dropdown").css({display:"block"}),o=t.screenY}),c(document).on("mouseleave",".wpglobus-customize-selector",function(t){0!=o&&t.screenY-o<=0&&c(".wpglobus-customize-selector-dropdown").css({display:"none"})}),c(document).on("mouseleave",".wpglobus-customize-selector-dropdown",function(t){c(".wpglobus-customize-selector-dropdown").css({display:"none"})}),c(document).on("mouseenter",".wpglobus-customize-selector-dropdown .item",function(t){var e=c(this),o=e.data("language");e.addClass("active"),e.css({"background-color":"#fff"}),e.find(".value-"+o).css({"font-weight":"bold"})}),c(document).on("mouseleave",".wpglobus-customize-selector-dropdown .item",function(t){var e=c(this);e.removeClass("active"),e.css({"background-color":"#eee"}),c(this).find(".value").css({"font-weight":""})}),c(document).on("click",".wpglobus-customize-selector-dropdown .item",function(t){var e=c(this).data("language");void 0!==e&&e!=c(".wpglobus-customize-selector").data("language")&&a.languageChanged(e)}),c(document).on("click",".wpglobus-customize-item-settings",function(t){wp.customize.control("wpglobus_fields_settings_section").expand({completeCallback:a.settingsSectionExpand}),c(".wpglobus-customize-selector-dropdown").css({display:"none"})})},languageChanged:function(t){WPGlobusCoreData.language=t,c(".wpglobus-customize-selector").data("language",t),c(".wpglobus-customize-selector .current-language").text(t),c(document).triggerHandler("wpglobus_customize_control_language",[WPGlobusCoreData.language]),a.setControlsValue()},setControlsValue:function(){c(".wpglobus-customize-control").each(function(t,e){var o,n=c(e),e=n.data("customize-setting-link");void 0===WPGlobusCustomize.controlInstances[e]&&(e=n.data("wpglobus-customize-control"),void 0===WPGlobusCustomize.controlInstances[e])||(n.hasClass("wpglobus-control-link")?(o=a.getTranslations(WPGlobusCustomize.controlInstances[e].setting),n.val(o[WPGlobusCoreData.language])):"object"==WPGlobusCustomize.controlInstances[e].settingType||"number"==WPGlobusCustomize.controlInstances[e].settingType||(o=WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[e].setting,WPGlobusCoreData.language,"RETURN_EMPTY"),"tinymce"==WPGlobusCustomize.controlInstances[e].type&&tinymce.get(e).setContent(o,{format:"raw"}),n.val(WPGlobusCore.TextFilter(o,"RETURN_EMPTY"))))}),c(".wpglobus-customize-widget-control").each(function(t,e){var o=c(e),e=o.data("widget");if(void 0===o.attr("id"))return!0;o.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[e].element[o.attr("id")].value,WPGlobusCoreData.language,"RETURN_EMPTY"))})},updateElements:function(s){void 0===s&&(s=!0),c.each(WPGlobusCustomize.controlInstances,function(t,e){if(!e.userControl.enabled)return!0;var o,n=wp.customize.control.instance(t);"link"==e.type?(o=a.getTranslations(WPGlobusCustomize.controlInstances[t].setting),s?(n.setting.set(o[WPGlobusCoreData.language]),e.element.val(n.setting())):e.element.val(o[WPGlobusCoreData.language])):"tinymce"==e.type?(o=WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[t].setting,WPGlobusCoreData.language,"RETURN_EMPTY"),tinymce.get(t).setContent(o,{format:"raw"}),e.element.val(o)):s?(n.setting.set(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[t].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),e.element.val(n.setting())):e.element.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[t].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))})},onSubmitEvents:function(t){"mouseenter"==t.type?c.each(a.controlWidgets[c(this).data("widget")].element,function(t,e){c("#"+t).val(e.value)}):"mouseleave"==t.type?a.widgetKeep||c.each(a.controlWidgets[c(this).data("widget")].element,function(t,e){c("#"+t).val(WPGlobusCore.TextFilter(e.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}):"click"==t.type&&(a.widgetKeep=!0)},attachWidgetListeners:function(t){void 0!==t.submit[0].id&&c(document).on("mouseenter","#"+t.submit[0].id,a.onSubmitEvents).on("mouseleave","#"+t.submit[0].id,a.onSubmitEvents).on("click","#"+t.submit[0].id,a.onSubmitEvents)},attachListeners:function(){c(".wpglobus-customize-control").on("keyup",function(t){var e=c(this),o=e.data("customize-setting-link");void 0===WPGlobusCustomize.controlInstances[o]&&(o=e.data("wpglobus-customize-control"),WPGlobusCustomize.controlInstances[o]),void 0===c(document).triggerHandler("wpglobus_customize_control_keyup",[e,o])&&("link"==WPGlobusCustomize.controlInstances[o].type?WPGlobusCustomize.controlInstances[o].setting=a.getString(WPGlobusCustomize.controlInstances[o].setting,e.val(),WPGlobusCoreData.language):WPGlobusCustomize.controlInstances[o].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[o].setting,e.val(),WPGlobusCoreData.language))}),c(document).on("keyup",".wpglobus-customize-widget-control",function(t){var e=c(this),o=e.data("widget");void 0!==WPGlobusCustomize.controlWidgets[o]&&(WPGlobusCustomize.controlWidgets[o].element[e.attr("id")].value=WPGlobusCore.getString(WPGlobusCustomize.controlWidgets[o].element[e.attr("id")].value,e.val(),WPGlobusCoreData.language))}),c(document).on("mouseenter","#save",function(t){c.each(WPGlobusCustomize.controlInstances,function(t,e){var o;e.userControl.enabled&&(o=wp.customize.control.instance(t),"tinymce"==e.type&&tinymce.get(t).setContent(e.setting,{format:"raw"}),o.setting.set(e.setting),e.element.val(o.setting()))})}).on("mouseleave","#save",function(t){a.instancesKeep||(a.updateElements(),wp.customize.previewer.refresh())}),c("#save").on("click",function(t){a.instancesKeep=!0}),c(document).on("ajaxSend",function(t,e,o){void 0!==o.data&&-1!=o.data.indexOf("wp_customize=on")&&-1!=o.data.indexOf("action=customize_save")&&(a.customizeSave=!0)}),c(document).on("ajaxComplete",function(t,o){void 0!==o.responseText&&(a.customizeSave?(a.updateElements(!1),a.instancesKeep&&(a.instancesKeep=!1)):(0<=o.responseText.indexOf("WP_CUSTOMIZER_SIGNATURE")&&(a.action="customizerAjaxComplete",a.setControlInstances()),c.each(WPGlobusCustomize.controlWidgets,function(t,e){t=t.replace("_","-");if(0<=o.responseText.indexOf(t))return e.submit.css({display:"block"}),e.control.liveUpdateMode=!1,c.each(e.element,function(t,e){c("#"+t).val(WPGlobusCore.TextFilter(e.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}),e.inWidgetTitle.text(": "+WPGlobusCore.TextFilter(e.control.setting().title,WPGlobusCustomize.languageAdmin)),a.widgetKeep=!1})),a.customizeSave=!1,wp.customize.previewer.refresh())})}};WPGlobusCustomize=c.extend({},WPGlobusCustomize,a),WPGlobusCustomize.init()});